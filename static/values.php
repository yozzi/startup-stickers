<?php
/////////////////////////////////////////////////////////////////////////////
//
// Valeurs des stickers et mise à jour
//
/////////////////////////////////////////////////////////////////////////////

    if(isset($_POST['update'])) {
        
        if(isset($_POST['row11'])) {      
            $newrow11 = 1;
        } else {
            $newrow11 = 0; 
        };
        
        if(isset($_POST['row12'])) {      
            $newrow12 = 1;
        } else {
            $newrow12 = 0; 
        };
        
        if(isset($_POST['row13'])) {      
            $newrow13 = 1;
        } else {
            $newrow13 = 0; 
        };
        
        if(isset($_POST['row14'])) {      
            $newrow14 = 1;
        } else {
            $newrow14 = 0; 
        };
        
        if(isset($_POST['row15'])) {      
            $newrow15 = 1;
        } else {
            $newrow15 = 0; 
        };
        
        if(isset($_POST['row16'])) {      
            $newrow16 = 1;
        } else {
            $newrow16 = 0; 
        };
        
        if(isset($_POST['row17'])) {      
            $newrow17 = 1;
        } else {
            $newrow17 = 0; 
        };
        
        
        
        
        if(isset($_POST['row21'])) {      
            $newrow21 = 1;
        } else {
            $newrow21 = 0; 
        };
        
        if(isset($_POST['row22'])) {      
            $newrow22 = 1;
        } else {
            $newrow22 = 0; 
        };
        
        if(isset($_POST['row23'])) {      
            $newrow23 = 1;
        } else {
            $newrow23 = 0; 
        };
        
        if(isset($_POST['row24'])) {      
            $newrow24 = 1;
        } else {
            $newrow24 = 0; 
        };
        
        if(isset($_POST['row25'])) {      
            $newrow25 = 1;
        } else {
            $newrow25 = 0; 
        };
        
        if(isset($_POST['row26'])) {      
            $newrow26 = 1;
        } else {
            $newrow26 = 0; 
        };
        
        if(isset($_POST['row27'])) {      
            $newrow27 = 1;
        } else {
            $newrow27 = 0; 
        };
        
        
        
        
        if(isset($_POST['row31'])) {      
            $newrow31 = 1;
        } else {
            $newrow31 = 0; 
        };
        
        if(isset($_POST['row32'])) {      
            $newrow32 = 1;
        } else {
            $newrow32 = 0; 
        };
        
        if(isset($_POST['row33'])) {      
            $newrow33 = 1;
        } else {
            $newrow33 = 0; 
        };
        
        if(isset($_POST['row34'])) {      
            $newrow34 = 1;
        } else {
            $newrow34 = 0; 
        };
        
        if(isset($_POST['row35'])) {      
            $newrow35 = 1;
        } else {
            $newrow35 = 0; 
        };
        
        if(isset($_POST['row36'])) {      
            $newrow36 = 1;
        } else {
            $newrow36 = 0; 
        };
        
        if(isset($_POST['row37'])) {      
            $newrow37 = 1;
        } else {
            $newrow37 = 0; 
        };
        
        
        
        
        if(isset($_POST['row41'])) {      
            $newrow41 = 1;
        } else {
            $newrow41 = 0; 
        };
        
        if(isset($_POST['row42'])) {      
            $newrow42 = 1;
        } else {
            $newrow42 = 0; 
        };
        
        if(isset($_POST['row43'])) {      
            $newrow43 = 1;
        } else {
            $newrow43 = 0; 
        };
        
        if(isset($_POST['row44'])) {      
            $newrow44 = 1;
        } else {
            $newrow44 = 0; 
        };
        
        if(isset($_POST['row45'])) {      
            $newrow45 = 1;
        } else {
            $newrow45 = 0; 
        };
        
        if(isset($_POST['row46'])) {      
            $newrow46 = 1;
        } else {
            $newrow46 = 0; 
        };
        
        if(isset($_POST['row47'])) {      
            $newrow47 = 1;
        } else {
            $newrow47 = 0; 
        };
        
        
        
        
        if(isset($_POST['row51'])) {      
            $newrow51 = 1;
        } else {
            $newrow51 = 0; 
        };
        
        if(isset($_POST['row52'])) {      
            $newrow52 = 1;
        } else {
            $newrow52 = 0; 
        };
        
        if(isset($_POST['row53'])) {      
            $newrow53 = 1;
        } else {
            $newrow53 = 0; 
        };
        
        if(isset($_POST['row54'])) {      
            $newrow54 = 1;
        } else {
            $newrow54 = 0; 
        };
        
        if(isset($_POST['row55'])) {      
            $newrow55 = 1;
        } else {
            $newrow55 = 0; 
        };
        
        if(isset($_POST['row56'])) {      
            $newrow56 = 1;
        } else {
            $newrow56 = 0; 
        };
        
        if(isset($_POST['row57'])) {      
            $newrow57 = 1;
        } else {
            $newrow57 = 0; 
        };
        
        
        if(isset($_POST['row61'])) {      
            $newrow61 = 1;
        } else {
            $newrow61 = 0; 
        };
        
        if(isset($_POST['row62'])) {      
            $newrow62 = 1;
        } else {
            $newrow62 = 0; 
        };
        
        if(isset($_POST['row63'])) {      
            $newrow63 = 1;
        } else {
            $newrow63 = 0; 
        };
        
        if(isset($_POST['row64'])) {      
            $newrow64 = 1;
        } else {
            $newrow64 = 0; 
        };
        
        if(isset($_POST['row65'])) {      
            $newrow65 = 1;
        } else {
            $newrow65 = 0; 
        };
        
        if(isset($_POST['row66'])) {      
            $newrow66 = 1;
        } else {
            $newrow66 = 0; 
        };
        
        if(isset($_POST['row67'])) {      
            $newrow67 = 1;
        } else {
            $newrow67 = 0; 
        };
        
        
        if(isset($_POST['row71'])) {      
            $newrow71 = 1;
        } else {
            $newrow71 = 0; 
        };
        
        if(isset($_POST['row72'])) {      
            $newrow72 = 1;
        } else {
            $newrow72 = 0; 
        };
        
        if(isset($_POST['row73'])) {      
            $newrow73 = 1;
        } else {
            $newrow73 = 0; 
        };
        
        if(isset($_POST['row74'])) {      
            $newrow74 = 1;
        } else {
            $newrow74 = 0; 
        };
        
        if(isset($_POST['row75'])) {      
            $newrow75 = 1;
        } else {
            $newrow75 = 0; 
        };
        
        if(isset($_POST['row76'])) {      
            $newrow76 = 1;
        } else {
            $newrow76 = 0; 
        };
        
        if(isset($_POST['row77'])) {      
            $newrow77 = 1;
        } else {
            $newrow77 = 0; 
        };
        
        $data = array(  'on11' => $newrow11,
                        'on12' => $newrow12,
                        'on13' => $newrow13,
                        'on14' => $newrow14,
                        'on15' => $newrow15,
                        'on16' => $newrow16,
                        'on17' => $newrow17,
                        'on21' => $newrow21,
                        'on22' => $newrow22,
                        'on23' => $newrow23,
                        'on24' => $newrow24,
                        'on25' => $newrow25,
                        'on26' => $newrow26,
                        'on27' => $newrow27,
                        'on31' => $newrow31,
                        'on32' => $newrow32,
                        'on33' => $newrow33,
                        'on34' => $newrow34,
                        'on35' => $newrow35,
                        'on36' => $newrow36,
                        'on37' => $newrow37,
                        'on41' => $newrow41,
                        'on42' => $newrow42,
                        'on43' => $newrow43,
                        'on44' => $newrow44,
                        'on45' => $newrow45,
                        'on46' => $newrow46,
                        'on47' => $newrow47,
                        'on51' => $newrow51,
                        'on52' => $newrow52,
                        'on53' => $newrow53,
                        'on54' => $newrow54,
                        'on55' => $newrow55,
                        'on56' => $newrow56,
                        'on57' => $newrow57,
                      'on61' => $newrow61,
                        'on62' => $newrow62,
                        'on63' => $newrow63,
                        'on64' => $newrow64,
                        'on65' => $newrow65,
                        'on66' => $newrow66,
                        'on67' => $newrow67,
                      'on71' => $newrow71,
                        'on72' => $newrow72,
                        'on73' => $newrow73,
                        'on74' => $newrow74,
                        'on75' => $newrow75,
                        'on76' => $newrow76,
                        'on77' => $newrow77,
                      );
//        print_r($data);
//        
//        print_r($_POST);
        
        $data = array_replace($data,$_POST);
        
        $data = serialize($data);
        
        $ret = file_put_contents('http://startup.dev/wp-content/plugins/startup-stickers/data/values.txt', $data, LOCK_EX);
        if($ret === false) {
            die('Impossible d\'&eacute;crire dans le fichier <strong>values.txt</strong>');
        }
        else { ?>
            
            <div id="messages" class="alert alert-success" role="alert">
                <div class="container">    
                    <div class="row">
                        <div class="col-xs-12">Tableau mis &agrave; jour</div>
                    </div>
                </div>    
            </div>
        <?php }
    }

/////////////////////////////////////////////////////////////////////////////
//
// Ordre des stickers et reset
//
/////////////////////////////////////////////////////////////////////////////
    if(isset($_POST['reset']) && !isset($_POST['update']) ) {
        
        $order1 = range(1, 7);
        shuffle($order1);
        $order1 = implode($order1);

        $order2 = range(1, 7);
        shuffle($order2);
        $order2 = implode($order2);

        $order3 = range(1, 7);
        shuffle($order3);
        $order3 = implode($order3);

        $order4 = range(1, 7);
        shuffle($order4);
        $order4 = implode($order4);

        $order5 = range(1, 7);
        shuffle($order5);
        $order5 = implode($order5);
        
        $order6 = range(1, 7);
        shuffle($order6);
        $order6 = implode($order6);
        
        $order7 = range(1, 7);
        shuffle($order7);
        $order7 = implode($order7);
        
        
        
        $data = $order1 . $order2 . $order3 . $order4 . $order5 . $order6 . $order7;
        $ret1 = file_put_contents(plugins_url() . '/startup-stickers/data/order.txt', $data, LOCK_EX);
        $ret2 = file_put_contents(plugins_url() . '/startup-stickers/data/values.txt', '', LOCK_EX);
        if($ret1 === false) {
            die('Impossible d\'&eacute;crire dans le fichier <strong>order.txt</strong>');
        } elseif($ret2 === false) {
            die('Impossible d\'&eacute;crire dans le fichier <strong>values.txt</strong>');
        }
        else { ?>
            
            <div id="messages" class="alert alert-success" role="alert">
                <div class="container">    
                    <div class="row">
                        <div class="col-xs-12">Tableau mis &agrave; z&eacute;ro</div>
                    </div>
                </div>    
            </div>
        <?php }
    }

/////////////////////////////////////////////////////////////////////////////
//
// Récupérer les valeurs dans les flatfiles
//
/////////////////////////////////////////////////////////////////////////////



    $values = unserialize(file_get_contents( plugins_url() . '/startup-stickers/data/values.txt'));


    $order =  trim(file_get_contents(plugins_url() . '/startup-stickers/data/order.txt'));
    
    $sticker1  =  substr($order,0,7);
    $sticker11 =  substr($sticker1,0,1);
    $sticker12 =  substr($sticker1,1,1);
    $sticker13 =  substr($sticker1,2,1);
    $sticker14 =  substr($sticker1,3,1);
    $sticker15 =  substr($sticker1,4,1);
    $sticker16 =  substr($sticker1,5,1);
    $sticker17 =  substr($sticker1,6,1);
    
    $sticker2  =  substr($order,7,7);
    $sticker21 =  substr($sticker2,0,1);
    $sticker22 =  substr($sticker2,1,1);
    $sticker23 =  substr($sticker2,2,1);
    $sticker24 =  substr($sticker2,3,1);
    $sticker25 =  substr($sticker2,4,1);
    $sticker26 =  substr($sticker2,5,1);
    $sticker27 =  substr($sticker2,6,1);

    $sticker3  =  substr($order,14,7);
    $sticker31 =  substr($sticker3,0,1);
    $sticker32 =  substr($sticker3,1,1);
    $sticker33 =  substr($sticker3,2,1);
    $sticker34 =  substr($sticker3,3,1);
    $sticker35 =  substr($sticker3,4,1);
    $sticker36 =  substr($sticker3,5,1);
    $sticker37 =  substr($sticker3,6,1);
    
    $sticker4  =  substr($order,21,7);
    $sticker41 =  substr($sticker4,0,1);
    $sticker42 =  substr($sticker4,1,1);
    $sticker43 =  substr($sticker4,2,1);
    $sticker44 =  substr($sticker4,3,1);
    $sticker45 =  substr($sticker4,4,1);
    $sticker46 =  substr($sticker4,5,1);
    $sticker47 =  substr($sticker4,6,1);
    
    $sticker5  =  substr($order,28,7);
    $sticker51 =  substr($sticker5,0,1);
    $sticker52 =  substr($sticker5,1,1);
    $sticker53 =  substr($sticker5,2,1);
    $sticker54 =  substr($sticker5,3,1);
    $sticker55 =  substr($sticker5,4,1);
    $sticker56 =  substr($sticker5,5,1);
    $sticker57 =  substr($sticker5,6,1);

    $sticker6  =  substr($order,28,7);
    $sticker61 =  substr($sticker6,0,1);
    $sticker62 =  substr($sticker6,1,1);
    $sticker63 =  substr($sticker6,2,1);
    $sticker64 =  substr($sticker6,3,1);
    $sticker65 =  substr($sticker6,4,1);
    $sticker66 =  substr($sticker6,5,1);
    $sticker67 =  substr($sticker6,6,1);

    $sticker7  =  substr($order,28,7);
    $sticker71 =  substr($sticker7,0,1);
    $sticker72 =  substr($sticker7,1,1);
    $sticker73 =  substr($sticker7,2,1);
    $sticker74 =  substr($sticker7,3,1);
    $sticker75 =  substr($sticker7,4,1);
    $sticker76 =  substr($sticker7,5,1);
    $sticker77 =  substr($sticker7,6,1);